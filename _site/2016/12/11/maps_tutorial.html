<!DOCTYPE html>
<html class="no-js">
  <head>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Spatial Data and Maps</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

<!-- CSS -->
<link rel="stylesheet" href="/css/owl.carousel.css" />
<link rel="stylesheet" href="/css/bootstrap.min.css" />
<link rel="stylesheet" href="/css/font-awesome.min.css" />
<link rel="stylesheet" href="/css/airspace.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/ionicons.min.css" />
<link rel="stylesheet" href="/css/animate.css" />
<link rel="stylesheet" href="/css/responsive.css" />
<link rel="stylesheet" href="/css/syntax.css" />

<!-- Js -->
<script src="/js/vendor/modernizr-2.6.2.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/plugins.js"></script>
<script src="/js/min/waypoints.min.js"></script>
<script src="/js/jquery.counterup.js"></script>

<!-- Google Map -->
<script src="https://maps.googleapis.com/maps/api/js"></script>
<script src="/js/google-map-init.js"></script>


<script src="/js/main.js"></script>


  </head>
  <body>


    <!-- Header Start -->
<header>
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <!-- header Nav Start -->
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://jade.github.io/">
              <img src="/img/jade-logo.png" alt="Logo">
            </a>
          </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav navbar-right">
                <li><a href="/">Home</a></li>
               <!-- <li><a href="/tutorials">Tutorials</a></li>
                <li><a href="http://localhost:4000//blog">Blog</a></li>-->
                <li><a href="http://localhost:4000//consortium">Consortium</a></li>
                <li><a href="http://localhost:4000//access">Access</a></li>
                <li><a href="http://localhost:4000//news">News and Events</a></li>
                <li><a href="http://localhost:4000//support">Support</a></li>
                <li><a href="http://localhost:4000//links">Useful links</a></li>
                <!--<li><a href="/contact">Contact</a></li>-->
              </ul>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
      </div>
    </div>
  </div>
</header><!-- header close -->



    <div class="post">
  <!-- Wrapper Start -->
  <section id="intro" style="border: 1px dotted #ddd;">
    <div class="container">
      <div class="row">
        <div>
          <div class="block">
            <h1>Spatial Data and Maps</h1>
            <div class="post-info-wrapper">
              <p class="italic">By <span class="bold">John</span> on <span class="bold">December 11, 2016</span></p>
            </div>
            <hr />
            <p><div class="block">
  <center>
  <img src="/img/tutheader_maps.jpg" alt="Img" />
</center>
</div>

<h1 id="tutorial-aims">Tutorial Aims:</h1>

<h4 id="1-learn-to-download-map-tiles-using-ggmap">1. Learn to download map tiles using ggmap</h4>

<h4 id="2-make-a-simple-map-using-ggmap">2. Make a simple map using ggmap</h4>

<h4 id="3-import-manipulate-and-plot-shapefiles">3. Import, manipulate and plot shapefiles</h4>

<h1 id="steps">Steps:</h1>

<h4 id="1-why-use-r-to-make-maps"><a href="#why">1. Why use R to make maps?</a></h4>

<h4 id="2-downloading-the-relevant-packages"><a href="#download">2. Downloading the relevant packages</a></h4>

<h4 id="3-getting-your-head-around-map-data"><a href="#map_data">3. Getting your head around map data</a></h4>

<h4 id="4-creating-a-map-using-ggmap"><a href="#create">4. Creating a map using ggmap</a></h4>

<h4 id="5-using-shapefiles"><a href="#shp">5. Using shapefiles</a></h4>

<hr />
<p>Open up a new R Script where you will be adding the code for your maps. All the resources for this tutorial, including some helpful cheatsheets can be downloaded from <a href="https://github.com/ourcodingclub/CC-6-Maps">this repository</a> Clone and download the repo as a zipfile, then unzip and set the folder as your working directory by running the code below (subbing in the actual folder path), or clicking <code class="highlighter-rouge">Session/ Set Working Directory/ Choose Directory</code> from the RStudio menu.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">setwd</span><span class="p">(</span><span class="s2">"PATH_TO_FOLDER"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><a name="why"></a></p>

<h2 id="why-use-r-for-spatial-data">Why use R for spatial data?</h2>

<h5 id="less-clicking"><strong>Less clicking:</strong></h5>
<ul>
  <li>Most conventional GIS software use a Graphical User Interface (GUI) which makes them easier to fumble through when you don’t know what you’re doing, but point and click interfaces become very laborious when performing analyses for the <em>n</em> th time or when you really know your way around the software. R runs using a Command Line Interface, so while there may be more of a learning curve to begin with, it’s pretty sweet once you know what to do.</li>
</ul>

<h5 id="reproducible-analyses-with-new-data"><strong>Reproducible analyses with new data:</strong></h5>
<ul>
  <li>Imagine you have a data project where you are given new data every week, which you want compare using maps. Using a GUI, you would have to repeat your analyses step by step, every time your data came in, being careful to maintain formatting between maps. Using the command line in R, you only have to plug in the new data to the script and the maps will look the same every time.</li>
</ul>

<h5 id="free"><strong>Free:</strong></h5>
<ul>
  <li>While ArcGIS and SuperGIS cost money to use, R packages are free and probably always will be.</li>
</ul>

<h5 id="a-range-of-gis-packages-for-different-applications"><strong>A range of GIS packages for different applications:</strong></h5>
<ul>
  <li>Using the R package system you can find the right GIS application for your project, and you can adapt and hack the packages already there to create something specific for your project.</li>
</ul>

<p><a name="download"></a></p>

<h2 id="downloading-the-relevant-packages">Downloading the relevant packages</h2>

<p>Install the following packages:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"readr"</span><span class="p">)</span><span class="w"> </span><span class="c1"># Read in files
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"dplyr"</span><span class="p">)</span><span class="w"> </span><span class="c1"># Formatting data
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"rgdal"</span><span class="p">)</span><span class="w"> </span><span class="c1"># Manipulate map data
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"devtools"</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">devtools</span><span class="p">)</span><span class="w">
  </span><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"dkahle/ggmap"</span><span class="p">)</span><span class="w"> </span><span class="c1"># Plot map data, download map tiles from online sources
</span><span class="w">    </span><span class="n">library</span><span class="p">(</span><span class="n">ggmap</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>At the time of writing, <code class="highlighter-rouge">ggmap</code> needs to be compiled from source to maintain some functionality, hence `  devtools::install_github(“dkahle/ggmap”)`, but this might change in the future.</p>

<p><a name="map_data"></a></p>

<h2 id="getting-your-head-around-map-data">Getting your head around map data</h2>

<p>The easiest way to think about map data is to first imagine a graph displaying whatever data you want, but with the x and y axes denoting longitude and latitude:</p>

<p><img src="/img/Trout_Europe_Plot.jpeg" alt="Img" /></p>

<p>Then it’s a simple case of adding a background map to your image to place the data points in the real world. In this case, the map was pulled from google maps using the <code class="highlighter-rouge">ggmap</code> package.</p>

<p><img src="/img/Trout_Europe_Map.jpeg" alt="Img" /></p>

<p>That was a simple example, and maps can incorporate more complex elements like polygons and lines:</p>

<p><img src="/img/Polygon_Line_Map.jpeg" alt="Img" /></p>

<p><a name="create"></a></p>

<h2 id="creating-a-map-using-ggmap">Creating a map using ggmap</h2>

<p>For this part of the tutorial we are going to create a map showing the spatial extent of 2 species of bird.  Rueppell’s Vulture (<em>Gyps rueppellii</em>) feeds on large mammalian carrion and the African Penguin (<em>Spheniscus demersus</em>) feeds on small marine fish, it’s probable that they have distinct spatial patterns, we shall see! We will use species occurence data from the <a href="http://www.gbif.org/" target="_blank">Global Biodiversity Information Facility (GBIF)</a>, which you have already downloaded and unzipped from <a href="https://github.com/ourcodingclub/CC-6-Maps">the repository</a> for this tutorial.</p>

<p>First, import the data we need, <code class="highlighter-rouge">Gyps_rueppellii_GBIF.csv</code> and <code class="highlighter-rouge">Spheniscus_dermersus_GBIF.csv</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">vulture</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"Gyps_rueppellii_GBIF.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">)</span><span class="w">
</span><span class="n">penguin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"Spheniscus_dermersus_GBIF.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Now onto cleaning up the data using <code class="highlighter-rouge">dplyr</code>. If you are keen to learn more about using the <code class="highlighter-rouge">dplyr</code> package, check out our <a href="https://ourcodingclub.github.io/2017/01/16/piping.html">tutorial on data formatting and manipulation</a>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">

</span><span class="c1"># Keep only the columns we need
</span><span class="n">vars</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"gbifid"</span><span class="p">,</span><span class="w"> </span><span class="s2">"scientificname"</span><span class="p">,</span><span class="w"> </span><span class="s2">"locality"</span><span class="p">,</span><span class="w"> </span><span class="s2">"decimallongitude"</span><span class="p">,</span><span class="w"> </span><span class="s2">"decimallatitude"</span><span class="p">,</span><span class="w"> </span><span class="s2">"coordinateuncertaintyinmeters"</span><span class="p">)</span><span class="w">

</span><span class="n">vulture_trim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vulture</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">one_of</span><span class="p">(</span><span class="n">vars</span><span class="p">))</span><span class="w"> </span><span class="c1"># `one_of()` is part of `select()` and selects all columns specified in `vars`
</span><span class="n">penguin_trim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">penguin</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">one_of</span><span class="p">(</span><span class="n">vars</span><span class="p">))</span><span class="w">

</span><span class="c1"># Combine the dataframes
</span><span class="n">pc_trim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">bind_rows</span><span class="p">(</span><span class="n">vulture_trim</span><span class="p">,</span><span class="w"> </span><span class="n">penguin_trim</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">pc_trim</span><span class="p">)</span><span class="w"> </span><span class="c1"># Check column names and content
# Check that species names are consistent
</span><span class="n">unique</span><span class="p">(</span><span class="n">pc_trim</span><span class="o">$</span><span class="n">scientificname</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Needs cleaning up
</span><span class="w">
</span><span class="c1"># Clean up "scientificname" to make names consistent
</span><span class="n">pc_trim</span><span class="o">$</span><span class="n">scientificname</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pc_trim</span><span class="o">$</span><span class="n">scientificname</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
                            </span><span class="n">recode</span><span class="p">(</span><span class="s2">"Gyps rueppellii (A. E. Brehm, 1852)"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Gyps rueppellii"</span><span class="p">,</span><span class="w">
                              </span><span class="s2">"Gyps rueppellii subsp. erlangeri Salvadori, 1908"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Gyps rueppellii"</span><span class="p">,</span><span class="w">
                              </span><span class="s2">"Gyps rueppelli rueppelli"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Gyps rueppellii"</span><span class="p">,</span><span class="w">
                              </span><span class="s2">"Spheniscus demersus (Linnaeus, 1758)"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Spheniscus demersus"</span><span class="w">
                              </span><span class="p">)</span><span class="w">
</span><span class="c1"># Checking names
</span><span class="n">unique</span><span class="p">(</span><span class="n">pc_trim</span><span class="o">$</span><span class="n">scientificname</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Done
</span></code></pre>
</div>

<p>Now we can make a preliminary plot to make sure the data looks right. Remember, a map is just a graph with longitude and latitude as the x and y axes:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">pc_trim</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallongitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallatitude</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scientificname</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scientificname</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>It looks like some of the penguin populations might be from zoos in U.S cities, let’s remove those entries:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">pc_trim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pc_trim</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">decimallongitude</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">-50</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Plot it again:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">pc_trim</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallongitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallatitude</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scientificname</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scientificname</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>Now to make a map out of our graph using <code class="highlighter-rouge">ggmap</code>, which pulls map tiles from various online sources, including google maps and open street maps.</p>

<p>First make a bounding box (<code class="highlighter-rouge">bbox</code>), to tell <code class="highlighter-rouge">ggmap</code> where to download map tiles from. The bounding box must be in the form of a vector, with decimal latitude and longitude values in this order <code class="highlighter-rouge">lowerleftlon, lowerleftlat, upperrightlon, upperrightlat</code>, which we can extract from our data frame using the following code:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bbox</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">pc_trim</span><span class="o">$</span><span class="n">decimallongitude</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
          </span><span class="nf">min</span><span class="p">(</span><span class="n">pc_trim</span><span class="o">$</span><span class="n">decimallatitude</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
          </span><span class="nf">max</span><span class="p">(</span><span class="n">pc_trim</span><span class="o">$</span><span class="n">decimallongitude</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
          </span><span class="nf">max</span><span class="p">(</span><span class="n">pc_trim</span><span class="o">$</span><span class="n">decimallatitude</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="w">
          </span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>the <code class="highlighter-rouge">+2</code> <code class="highlighter-rouge">-2</code> values are added to make the edges of the map slightly larger than the limits of the data, purely for aesthetic reasons.</p>

<p>Now to download the map data from <code class="highlighter-rouge">ggmap</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">Map_penguin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_map</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"stamen"</span><span class="p">,</span><span class="w"> </span><span class="n">maptype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"terrain"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>We can check that the map is correct by plotting the <code class="highlighter-rouge">Map_penguin</code> object:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggmap</span><span class="p">(</span><span class="n">Map_penguin</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>To add the data, use <code class="highlighter-rouge">ggplot2</code> syntax:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggmap</span><span class="p">(</span><span class="n">Map_penguin</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallongitude</span><span class="p">,</span><span class="w">
                 </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallatitude</span><span class="p">,</span><span class="w">
                 </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scientificname</span><span class="p">),</span><span class="w">
             </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pc_trim</span><span class="p">,</span><span class="w">
             </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.6</span><span class="p">,</span><span class="w">                     </span><span class="c1"># `alpha=` sets the transparency of `geom_point()`, from 0 (transparent) to 1 (opaque)
</span><span class="w">             </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                      </span><span class="c1"># `size=` sets the diameter of `geom_point()`
</span><span class="w">  </span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># `scale_colour_manual()` sets the geom_point colours to specific values
</span><span class="w">  </span><span class="n">xlab</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="s2">"Decimal Longitude ("</span><span class="o">*</span><span class="n">degree</span><span class="o">*</span><span class="s2">")"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># Wrapping label in `expression()` and using *degree* lets us add a degree symbol
</span><span class="w">  </span><span class="n">ylab</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="s2">"Decimal Latitude ("</span><span class="o">*</span><span class="n">degree</span><span class="o">*</span><span class="s2">")"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>Now you should have a map that looks something like this:</p>

<p><img src="/img/Birds_ggmap.jpg" alt="Img" /></p>

<h4 id="ggmap-can-access-a-whole-load-of-different-map-types-have-a-go-at-redoing-the-map-above-with-some-alternative-map-types-by-replacing-the-source--and-maptype--arguments-in-get_map">ggmap can access a whole load of different map types. Have a go at redoing the map above with some alternative map types by replacing the <code class="highlighter-rouge">source =</code> and <code class="highlighter-rouge">maptype =</code> arguments in <code class="highlighter-rouge">get_map()</code>:</h4>

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-yw4l{vertical-align:top}
</style>

<table class="tg">
  <tr>
    <th class="tg-031e">`source =`</th>
    <th class="tg-031e"><b>google</b></th>
    <th class="tg-yw4l"><b>stamen</b></th>
    <th class="tg-yw4l"><b>osm</b></th>
  </tr>
  <tr>
    <td class="tg-031e" rowspan="11">`maptype =` </td>
    <td class="tg-031e">satellite</td>
    <td class="tg-yw4l">terrain</td>
    <td class="tg-yw4l">&lt;empty&gt;</td>
  </tr>
  <tr>
    <td class="tg-031e">terrain</td>
    <td class="tg-yw4l">terrain-background</td>
    <td class="tg-yw4l"></td>
  </tr>
  <tr>
    <td class="tg-031e">roadmap</td>
    <td class="tg-yw4l">terrain-labels</td>
    <td class="tg-yw4l"></td>
  </tr>
  <tr>
    <td class="tg-yw4l">hybrid</td>
    <td class="tg-yw4l">terrain-lines</td>
    <td class="tg-yw4l"></td>
  </tr>
  <tr>
    <td class="tg-yw4l">terrain</td>
    <td class="tg-yw4l">toner</td>
    <td class="tg-yw4l"></td>
  </tr>
  <tr>
    <td class="tg-yw4l">terrain-background</td>
    <td class="tg-yw4l">toner-background</td>
    <td class="tg-yw4l"></td>
  </tr>
  <tr>
    <td class="tg-yw4l"><br /></td>
    <td class="tg-yw4l">toner-hybrid</td>
    <td class="tg-yw4l"></td>
  </tr>
  <tr>
    <td class="tg-yw4l"><br /></td>
    <td class="tg-yw4l">toner-labels</td>
    <td class="tg-yw4l"></td>
  </tr>
  <tr>
    <td class="tg-yw4l"><br /></td>
    <td class="tg-yw4l">toner-lines</td>
    <td class="tg-yw4l"></td>
  </tr>
  <tr>
    <td class="tg-yw4l"><br /></td>
    <td class="tg-yw4l">toner-lite</td>
    <td class="tg-yw4l"></td>
  </tr>
  <tr>
    <td class="tg-yw4l"><br /></td>
    <td class="tg-yw4l">watercolor</td>
    <td class="tg-yw4l"></td>
  </tr>
</table>

<p><img src="/img/Map_collage.png" alt="Img" /></p>

<p><a name="shp"></a></p>

<h2 id="using-shapefiles">Using shapefiles</h2>
<p>Shapefiles are a data format developed by <a href="http://www.esri.com">ESRI</a> used to hold information on spatial objects. Despite the name, a shapefile consists of a few different files:</p>

<p><strong>Mandatory files:</strong></p>

<p>.shp = The main file containing the geometry data</p>

<p>.shx = An index file</p>

<p>.dbf = An attribute file holding information on each object</p>

<p><strong>Additional files:</strong></p>

<p>.prj = A file containing information on the Co-ordinate Reference system</p>

<p>.shp.xml = a file containing object metadata, citations for data, etc.</p>

<p><strong>And many more!</strong></p>

<p>We are going to use a shapefile of the World’s Freshwater Ecoregions provided by <a href="http://www.feow.org">The Nature Conservancy</a> to investigate the range of the Brown Trout in Europe using data from the <a href="http://www.gbif.org">GBIF database</a>.</p>

<p>Read in the GBIF data:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">Brown_Trout</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"Brown_Trout_GBIF_clip.csv"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Let’s check that the data is displaying correctly using <code class="highlighter-rouge">ggplot()</code> like in the previous example:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">Brown_Trout</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallongitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallatitude</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p>We can roughly see the outline of Scandinavia and maybe the Northern Mediterranean.</p>

<p>Again, to plot our map, first make a bounding box, then download the map tiles using <code class="highlighter-rouge">ggmap</code>. We can set the map colour to greyscale with <code class="highlighter-rouge">color = "bw"</code>, so our shapefiles stand out. We can also set the map zoom with <code class="highlighter-rouge">zoom = 3</code>, with 3 being continent scale and 21 being individual buildings. This time we will make the bounding box manually:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bbox</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-40</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="m">85</span><span class="p">)</span><span class="w">
</span><span class="n">Map_trout</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_map</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"google"</span><span class="p">,</span><span class="w"> </span><span class="n">maptype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"terrain"</span><span class="p">,</span><span class="w"> </span><span class="n">zoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bw"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Then we can plot the map tiles with the data using <code class="highlighter-rouge">ggmap()</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggmap</span><span class="p">(</span><span class="n">Map_trout</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
             </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallongitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallatitude</span><span class="p">),</span><span class="w">
             </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Brown_Trout</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Longitude"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Latitude"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Now to read in the shapefiles. <code class="highlighter-rouge">readOGR()</code> converts a shapefile into a spatial object that can be interpreted by <code class="highlighter-rouge">ggmap</code>. <code class="highlighter-rouge">dsn = "FEOW-TNC"</code> gives the name of the folder where the shapefile can be found, <code class="highlighter-rouge">layer = "FEOWv1_TNC"</code> gives the name of the files to read in. It’s important to keep filenames identical in a shapefile:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">shpData_FEOW</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readOGR</span><span class="p">(</span><span class="n">dsn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"FEOW-TNC"</span><span class="p">,</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"FEOWv1_TNC"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Now we have to check that the shapefile has the right Co-ordinate Reference System (CRS) to be read by <code class="highlighter-rouge">ggmap</code>. A CRS specifies how the coordinates of the 2D map displayed on the computer screen are related to the real globe, which is roughly spherical. There are lot’s of different CRSs, used for maps of different scales, or of different parts of the globe (e.g. the poles) and it is important to keep them consistent amongst all the elements of your map For more information on CRSs have a look at “Coord_Ref_Systems.pdf” in <a href="https://github.com/ourcodingclub/CC-6-Maps">the repository</a> :</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">proj4string</span><span class="p">(</span><span class="n">shpData_FEOW</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>To transform the CRS to the correct one we can use <code class="highlighter-rouge">spTransform</code> by specifying the correct CRS for <code class="highlighter-rouge">ggmap</code> which is <a href="http://spatialreference.org/ref/epsg/wgs-84/">EPSG:WGS84</a> (<code class="highlighter-rouge">+proj=longlat +datum=WGS84</code>), then restructure the object into a data frame ready for plotting using <code class="highlighter-rouge">fortify()</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">shpData_FEOW</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">spTransform</span><span class="p">(</span><span class="n">shpData_FEOW</span><span class="p">,</span><span class="w"> </span><span class="n">CRS</span><span class="p">(</span><span class="s2">"+proj=longlat +datum=WGS84"</span><span class="p">))</span><span class="w">
</span><span class="n">shpData_FEOW</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fortify</span><span class="p">(</span><span class="n">shpData_FEOW</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Now, plot the map, point data and shapefile together. The shapefiles can be plotted using <code class="highlighter-rouge">geom_map()</code>, specifying that the map (i.e. the shapes) and the data (i.e. the colours filling the shapes) both come from the shapefile, <code class="highlighter-rouge">color = black</code> makes the shape outlines black:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">Map_FEOW</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggmap</span><span class="p">(</span><span class="n">Map_trout</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_map</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shpData_FEOW</span><span class="p">,</span><span class="w">
           </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shpData_FEOW</span><span class="p">,</span><span class="w">
           </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">map_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">),</span><span class="w">
           </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
             </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallongitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallatitude</span><span class="p">),</span><span class="w">
             </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Brown_Trout</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Longitude"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Latitude"</span><span class="p">)</span><span class="w">

</span><span class="n">Map_FEOW</span><span class="w">
</span></code></pre>
</div>

<p>We can add extra elements using the <code class="highlighter-rouge">ggplot2</code> syntax, just like a normal <code class="highlighter-rouge">ggplot()</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">Map_FEOW</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">annotate</span><span class="p">(</span><span class="s2">"rect"</span><span class="p">,</span><span class="w"> </span><span class="n">xmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">xmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">35</span><span class="p">,</span><span class="w"> </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">55</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">65</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">annotate</span><span class="p">(</span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">27.5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">61</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Restock"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">annotate</span><span class="p">(</span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">27.5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">59</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Area"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<hr />

<hr />

<h4 id="check-out-our-useful-links-page-where-you-can-find-loads-of-guides-and-cheatsheets">Check out our <a href="https://ourcodingclub.github.io/links/" target="_blank">Useful links</a> page where you can find loads of guides and cheatsheets.</h4>

<h4 id="if-you-have-any-questions-about-completing-this-tutorial-please-contact-us-on-ourcodingclubgmailcom">If you have any questions about completing this tutorial, please contact us on ourcodingclub@gmail.com</h4>

<h4 id="we-would-love-to-hear-your-feedback-on-the-tutorial-whether-you-did-it-in-the-classroom-or-online"><a href="https://www.surveymonkey.co.uk/r/NMD3N5K" target="_blank">We would love to hear your feedback on the tutorial, whether you did it in the classroom or online!</a></h4>

<ul class="social-icons">
	<li>
		<h3>
			<a href="https://twitter.com/our_codingclub" target="_blank">&nbsp;Follow our coding adventures on Twitter! <i class="fa fa-twitter"></i></a>
		</h3>
	</li>
</ul>

<h3 id="subscribe-to-our-mailing-list">  Subscribe to our mailing list:</h3>
<div class="container">
	<div class="block">
        <!-- subscribe form start -->
		<div class="form-group">
			<form action="https://getsimpleform.com/messages?form_api_token=de1ba2f2f947822946fb6e835437ec78" method="post">
			<div class="form-group">
				<input type="text" class="form-control" name="Email" placeholder="Email" required="" />
			</div>
			<div>
                        	<button class="btn btn-default" type="submit">Subscribe</button>
                    	</div>
                	</form>
		</div>
	</div>
</div>
</p>
          </div>
        </div><!-- .col-md-7 close -->
      </div>
    </div>
  </section>
</div>
<p class="center-text" style="padding: 30px;">
  <a href="/blog">Back to blog</a>
</p>











    <!-- footer Start -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="footer-manu">
          <ul>
            <li><a href="/consortium">About Us</a></li>
        <!--    <li><a href="/contact">Contact us</a></li>-->
          </ul>
        </div>
        <p>Content by <a href="/about/">..</a>.</p>
        <p>Copyright &copy; Design &amp; Developed by <a href="http://www.themefisher.com">Themefisher</a>. All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>

    

    </body>
</html>

